<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <title>サンプル 登録内容の更新フォーム</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    <link rel="stylesheet" href="js/update_style.css">
</head>
<body>

<form class="w-75 mx-auto" id="updatesheet">
<label class="mt-3"><big><big>登録内容の更新フォーム</big></big></label><br>
<font color="red"><small>＊変更したい項目をご入力下さい。</small></font><br>
<div id="parent_update" stylechild1ing: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p class="mt-3"><bi>利用者様のお名前</p>
<div id="parent_none">お名前が入力されていません。</div><div id="parent_notchar">お名前に記号を含めないでください。</div>
<input type="text" id="parent-name" class="form-control w-100 mt-1"/><p></p>
<div id="delete-msg1"><small>削除しました。</small><div style="text-align:right;"><input type="button" id="back1" class="mt-4 btn" value="元に戻す" ></div></div>
</div>
<div id="child1-update" style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p class="mt-3"><big>児童名(１人目)</big><div style="text-align:right;"><input type="button" id="delete1" class="mt-4 btn" value="消去する" ></div></p>
<div id="child1_none">お名前が入力されていません。</div><div id="child1_notchar">お名前に記号を含めないでください。</div><div id="child1_dup">お名前が重複しています。</div>
<input type="text" id="child1" class="form-control w-100 mt-1"/>
<input type="hidden" id="child1-post" />

<p class="mt-3"><big>放課後等デイサービス</big>
<select class="form-control w-100 mt-1" id="office1">
	<option value="smileday">スマイル</option>
	<option value="temu">てむてむ</option>
	<option value="hoya">ほやほや</option>
	<option value="naru">なるなる</option>
</select>
<input type="hidden" id="office1-post" />
</p>
</div>

<div id="delete-msg2"><small>削除しました。</small><div style="text-align:right;"><input type="button" id="back2" class="mt-4 btn" value="元に戻す" ></div></div>
<div id="child2-update" style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p class="mt-3"><big>児童名(２人目)</big><div style="text-align:right;"><input type="button" id="delete2" class="mt-4 btn" value="消去する" ></div></p>
<div id="child2_none">お名前が入力されていません。</div><div id="child2_notchar">お名前に記号を含めないでください。</div><div id="child2_dup">お名前が重複しています。</div>
<input type="text" id="child2" class="form-control w-100 mt-1" value="" />
<input type="hidden" id="child2-post" />
<p class="mt-3"><big>放課後等デイサービス</big>
<select class="form-control w-100 mt-1" id="office2">
	<option value="smileday">スマイル</option>
	<option value="temu">てむてむ</option>
	<option value="hoya">ほやほや</option>
	<option value="naru">なるなる</option>
</select>
<input type="hidden" id="office2-post" />
</p>
</div>

<div id="delete-msg3"><small>削除しました。</small><div style="text-align:right;"><input type="button" id="back3" class="mt-4 btn" value="元に戻す" ></div></div>
<div id="child3-update" style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p class="mt-3"><big>児童名(３人目)</big><div style="text-align:right;"><input type="button" id="delete3" class="mt-4 btn" value="消去する" ></div></p>
<div id="child3_none">お名前が入力されていません。</div><div id="child3_notchar">お名前に記号を含めないでください。</div><div id="child3_dup">お名前が重複しています。</div>
<input type="text" id="child3" class="form-control w-100 mt-1" value="" />
<input type="hidden" id="child3-post" />
<p class="mt-3"><big>放課後等デイサービス</big>
<select class="form-control w-100 mt-1" id="office3">
	<option value="smileday">スマイル</option>
	<option value="temu">てむてむ</option>
	<option value="hoya">ほやほや</option>
	<option value="naru">なるなる</option>
</select>
<input type="hidden" id="office3-post" />
</p>
</div>
<input type="submit" id="submit" class="mt-4 btn btn-primary" value="送信" disabled>	<input type="button" id="cancel" class="mt-4 btn" value="キャンセル" >

</form>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<script src="js/update_initialize.js"></script>
<script src="js/update_form.js"></script>
<script>
const formId = document.getElementById('updatesheet');
formId.onchange = () => {
	if(document.getElementById('parent-name').value !== ""){
		submit.disabled = false;
	}else submit.disabled = true;
};
							      
document.getElementById('submit').addEventListener('click', () => {
	let err = -1;
	const regex = new RegExp('[!-/:-@\[-`{-~]+', 'g');
	if(parent_name.value === ''){
		parent_none.style.display = "block";
		parent_notchar.style.display = "none";
		err = err + 1;
	}else if(regex.test(parent_name.value)){
		parent_notchar.style.display = "block";
		parent_none.style.display = "none";
		err = err + 1;
	}else{
		parent_notchar.style.display = "none";
		parent_none.style.display = "none";
	}

	let tmp_str1 = triming(child1_name.value);
	let tmp_str2 = triming(child2_name.value);
	let tmp_str3 = triming(child3_name.value);
	if(child1_update.style.display === "block"){
		if(child1_name.value === ''){
			child1_none.style.display = "block";
			child1_dup.style.display = "none";
			child1_notchar.style.display = "none";
			err = err + 1;
		}else if(regex.test(child1_name.value)){
			child1_notchar.style.display = "block";
			child1_dup.style.display = "none";
			child1_none.style.display= "none";
			err = err + 1;
		}else if(child2_update.style.display === "block" && tmp_str1 === tmp_str2){
			child1_dup.style.display = "block";
			child1_none.style.display= "none";
			child1_notchar.style.display = "none";
			err = err + 1;
		}else if(child3_update.style.display === "block" && tmp_str1 === tmp_str3){
			child1_dup.style.display = "block";
			child1_none.style.display= "none";
			child1_notchar.style.display = none";
     			err = err + 1;
		}else{
			child1_none.style.display = "none";
			child1_dup.style.display = "none";
			child1_notchar.style.display = "none";
		}
	}
	if(child2_update.style.display === "block"){
		if(child2_name.value === ''){
			child2_none.style.display = "block";
			child2_dup.style.display = "none";
			child2_notchar.style.display = "none";
			err = err + 1;
		}else if(regex.test(child2_name.value)){
			child2_notchar.style.display = "block";
			child2_dup.style.display = "none";
			child2_none.style.display= "none";
			err = err + 1;
		}else if(child1_update.style.display === "block" && tmp_str1 === tmp_str2){
			child2_dup.style.display = "block";
			child2_none.style.display= "none";
			child2_notchar.style.display = "none";
			err = err + 1;
		}else if(child3_update.style.display === "block" && tmp_str1 === tmp_str3){
			child2_dup.style.display = "block";
			child2_none.style.display= "none";
			child2_notchar.style.display = none";
     			err = err + 1;
		}else{
			child2_none.style.display = "none";
			child2_dup.style.display = "none";
			child2_notchar.style.display = "none";
		}
	}
	if(child3_update.style.display === "block"){
		if(child3_name.value === ''){
			child3_none.style.display = "block";
			child3_dup.style.display = "none";
			child3_notchar.style.display = "none";
			err = err + 1;
		}else if(regex.test(child3_name.value)){
			child3_notchar.style.display = "block";
			child3_dup.style.display = "none";
			child3_none.style.display= "none";
			err = err + 1;
		}else if(child1_update.style.display === "block" && tmp_str1 === tmp_str3){
			child3_dup.style.display = "block";
			child3_none.style.display= "none";
			child3_notchar.style.display = "none";
			err = err + 1;
		}else if(child2_update.style.display === "block" && tmp_str2 === tmp_str3){
			child3_dup.style.display = "block";
			child3_none.style.display= "none";
			child3_notchar.style.display = none";
     			err = err + 1;
		}else{
			child3_none.style.display = "none";
			child3_dup.style.display = "none";
			child3_notchar.style.display = "none";
		}
	}

	if(err > -1){
		alert("赤いところを直して、もう一度、送信ボタンを押してください。");
		event.preventDefault();
	}else{
		if(window.confirm("更新してよろしいですか？")) return true;
		else event.preventDefault();
	}
}, false);

document.getElementById('cancel').addEventListener('click', () => {
	if(window.confirm('登録を中止しますか？')){
		liff.closeWindow();
	}else event.preventDefault();
});
</script>
</body>
</html>
